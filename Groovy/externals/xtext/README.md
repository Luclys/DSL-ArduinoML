# ArduinoML in Xtext with Visual Studio Code Integration

This repository contains both the "traditional" xtext to have a rich editor in eclipse and the artefacts for the generation of VS-Code extensions

## Quickstart in VS-Code

Requires Visual Studio Code (VS Code) with version 1.4.0 or greater to be on the path as `code` and Java 8+ available as `java`.

- Run `./gradlew startCode`

This will start VS Code and after a few seconds load the `demo` folder of this repository.

## Quickstart in eclipse

- start eclipse in a new workspace and import all the `fr.polytech.si5.dsl.arduino*` projects as existing project (import -> project -> general -> existing project in the workspace). Open the xtext file (`fr.polytech.si5.dsl.arduino/src/fr/polytech/si5/dsl/arduino/ArduinoML.xtext`) and then right click -> run as -> generate Xtext artefacts
- run a new eclipse application, create a project and put a `.aml` file in it... The arduino code will be generated when the aml file is saved.

- optionnaly you can from the first eclipse test the webserver by running the `fr.polytech.si5.dsl.arduino.web/src/fr/polytech/si5/dsl/arduino/web/ServerLauncher.java` and point a web browser to [http://localhost:8080](http://localhost:8080).

## Quick start in the browser

 Run `./gradlew jettyRun` and point a web browser to [http://localhost:8080](http://localhost:8080).


## Project Structure

- `vscode-extension` (node based VS Code extension to run with a separate server using socket)
- `vscode-extension-self-contained` (node based VS Code extension to run with a embedded server using process io)
- `fr.polytech.si5.dsl.arduino` (contains the dsl defined in xtext and the generated ecore model)
    - `fr.polytech.si5.dsl.arduino/src/fr/polytech/si5/dsl/arduino/ArduinoML.xtext` is the grammar definition
    - `fr.polytech.si5.dsl.arduino/src/fr/polytech/si5/dsl/arduino/generator/ArduinoMLGenerator.xtend` is the code generation definition
- `fr.polytech.si5.dsl.arduino.ide` (contains the dsl specific customizations of the Xtext language server)
- `fr.polytech.si5.dsl.arduino.web` (a simple web integration generated by xtext)

## Building in Details

1. Make sure that `java -version` is executable and pointing to a Java 8+ JDK.
2. Type `code`. If the command is not known, open VS Code and select *View / Command Palette*. Enter `code` and select to install `code` on the path.
1. Run `./gradlew startCode` to build the DSL and the VS Code extensions.

### Scenario 1 (embedded server)

1. Install the self-contained extension into VS Code using
    `code --install-extension vscode-extension-self-contained/build/vscode/vscode-extension-self-contained-0.0.1.vsix`
2. Run a second instance of vscode on the demo folder `code demo`



### Build VS Code Extension Package manually (manually Gradle)

```
npm install -g vsce
cd vscode-extension
vsce package
cd ../vscode-extension-self-contained
vsce package
```
